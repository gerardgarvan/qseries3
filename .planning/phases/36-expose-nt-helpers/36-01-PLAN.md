---
phase: 36-expose-nt-helpers
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/repl.h]
autonomous: true

must_haves:
  truths:
    - "divisors(12) returns [1, 2, 3, 4, 6, 12]"
    - "mobius(6) returns 1, mobius(4) returns 0, mobius(30) returns -1"
    - "euler_phi(12) returns 4"
    - "help(divisors), help(mobius), help(euler_phi) work"
    - "All existing acceptance tests still pass"
  artifacts:
    - path: "src/repl.h"
      provides: "REPL bindings for divisors, mobius, euler_phi"
---

<objective>
Add REPL bindings for the 3 internal number theory helpers: divisors, mobius, euler_phi.

These functions already exist in src/qfuncs.h. This plan adds:
1. Help table entries in getHelpTable()
2. Dispatch handlers in dispatchBuiltin()
3. Acceptance test

No new math code needed — just wiring.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Add REPL bindings for divisors, mobius, euler_phi</name>
  <files>src/repl.h</files>
  <action>
**1. Add to getHelpTable() (alphabetical order):**

After the "coeffs" entry add:
```cpp
{"divisors", {"divisors(n)", "sorted list of positive divisors of n"}},
```

After the "etaq" entry add:
```cpp
{"euler_phi", {"euler_phi(n)", "Euler's totient φ(n)"}},
```

After the "mprodmake" entry (or appropriate alphabetical spot) add:
```cpp
{"mobius", {"mobius(n)", "Möbius function μ(n): 0 if n has squared factor, (-1)^k otherwise"}},
```

**2. Add dispatch handlers in dispatchBuiltin():**

Near the existing `legendre` and `sigma` handlers (after the sigma block, around line 596), add:

```cpp
if (name == "divisors") {
    if (args.size() != 1)
        throw std::runtime_error(runtimeErr(name, "expects 1 argument"));
    auto d = divisors(static_cast<int>(evi(0)));
    std::cout << "[";
    for (size_t i = 0; i < d.size(); ++i) {
        if (i > 0) std::cout << ", ";
        std::cout << d[i];
    }
    std::cout << "]" << std::endl;
    return DisplayOnly{};
}
if (name == "mobius") {
    if (args.size() != 1)
        throw std::runtime_error(runtimeErr(name, "expects 1 argument"));
    return static_cast<int64_t>(mobius(static_cast<int>(evi(0))));
}
if (name == "euler_phi") {
    if (args.size() != 1)
        throw std::runtime_error(runtimeErr(name, "expects 1 argument"));
    return static_cast<int64_t>(euler_phi(static_cast<int>(evi(0))));
}
```

Note: `divisors` prints directly and returns DisplayOnly because `vector<int>` in EvalResult is already used for mprodmake display. `mobius` and `euler_phi` return int64_t like `legendre` and `sigma`.
  </action>
  <verify>
Build: `g++ -std=c++20 -O2 -Wall -Wextra -Wpedantic -o qseries src/main.cpp` — zero warnings.

Smoke test:
```bash
printf 'divisors(12)\nmobius(6)\nmobius(4)\neuler_phi(12)\nhelp(divisors)\n' | ./qseries
```
Expected:
- `[1, 2, 3, 4, 6, 12]`
- `1`
- `0`
- `4`
- `divisors(n) — sorted list of positive divisors of n`
  </verify>
  <done>divisors, mobius, euler_phi accessible as REPL built-ins; build clean; help works</done>
</task>

<task type="auto">
  <name>Task 2: Run all acceptance tests</name>
  <files></files>
  <action>
Run all existing acceptance tests to confirm no regressions:
- `bash tests/acceptance.sh`
- `bash tests/acceptance-wins.sh`
- `bash tests/acceptance-optional-args.sh`
- `bash tests/acceptance-suppress-output.sh`

All must pass with zero failures.
  </action>
  <verify>All tests pass.</verify>
  <done>All acceptance tests pass; no regressions</done>
</task>

</tasks>

<verification>
1. Build clean under -Wall -Wextra -Wpedantic
2. divisors(12) = [1, 2, 3, 4, 6, 12]
3. mobius(6) = 1, mobius(4) = 0
4. euler_phi(12) = 4
5. All acceptance tests pass
</verification>

<success_criteria>
- 3 new REPL built-ins working with correct output
- Help entries for all 3
- Zero regressions
</success_criteria>

<output>
After completion, create `.planning/phases/36-expose-nt-helpers/36-01-SUMMARY.md`
</output>
