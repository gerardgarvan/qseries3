---
phase: 12-rogers-ramanujan-demo
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/series.h
  - src/repl.h
  - demo/garvan-demo.sh
autonomous: true

must_haves:
  truths:
    - "Sum Σ q^(n²)/(q;q)_n is displayed with 50 terms in demo"
    - "prodmake on that sum yields infinite product form"
    - "Series O-term uses Unicode exponent (O(q⁵⁰))"
    - "prodmake product uses Maple factor style (1-q) for n=1, (-q^n+1) for n>1"
  artifacts:
    - path: src/series.h
      provides: "O-term uses expToUnicode in str()"
      contains: "expToUnicode(trunc)"
    - path: src/repl.h
      provides: "series(f,T) honors T; formatProdmake Maple-style"
      contains: "formatProdmake"
    - path: demo/garvan-demo.sh
      provides: "Rogers-Ramanujan block with series(rr, 50)"
      contains: "series(rr, 50)"
  key_links:
    - from: "series built-in"
      to: "Series::str(Tr)"
      via: "f.str(std::min(Tr, 100))"
      pattern: "str\(std::min\(Tr"
    - from: "display(Series)"
      to: "prodmake output"
      via: "formatProdmake with mapleStyle"
---

<objective>
Align Rogers-Ramanujan demo output with qseriesdoc §3.1 Output (1) and (2) format. Fix REPL display: series() honors term count T; Series::str uses Unicode in O-term; formatProdmake supports Maple factor style. Update demo script to emit both Output (1) and (2) in matching style.

Purpose: DEMO-02 — demo artifact reproduces qseriesdoc §3.1 presentation
Output: Modified series.h, repl.h, garvan-demo.sh; demo runs and shows 50-term series + product in qseriesdoc style
</objective>

<execution_context>
@C:/Users/ggarv/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ggarv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/12-rogers-ramanujan-demo/12-RESEARCH.md
@qseriesdoc.md (lines 213–230 for Output (1) and (2))
@src/series.h (str, expToUnicode)
@src/repl.h (series built-in ~244, formatProdmake ~448, display ~582)
@demo/garvan-demo.sh (Rogers-Ramanujan block)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix series() built-in and Series::str O-term</name>
  <files>src/series.h, src/repl.h</files>
  <action>
Fix two format gaps:

1) **repl.h** — series built-in: Change `f.str(std::min(30, Tr))` to `f.str(std::min(Tr, 100))` so series(f,T) shows up to T terms (cap 100 for safety). Also change series(f) case from str(30) to str(std::min(100, T)) where T is env.T.

2) **series.h** — Series::str: Change the O-term from `" + O(q^" + std::to_string(trunc) + ")"` to use `expToUnicode(trunc)` so output is O(q⁵⁰) not O(q^50). Handle trunc=0 edge case; for empty series the O-term already uses to_string — apply expToUnicode there too if trunc > 0.

Preserve backward compatibility: str(maxTerms) behavior unchanged except O-term format. No change to display(Series) which uses str(30) for assignment echo.
  </action>
  <verify>Build with g++ -std=c++20 -O2 -o qseries main.cpp. Run: echo "series(sum(q^(n^2)/aqprod(q,q,n,50),n,0,8), 50)" | ./qseries — output must show ~50 terms and end with O(q⁵⁰) (Unicode).</verify>
  <done>series(f,50) displays 50 terms; O-term uses Unicode exponent.</done>
</task>

<task type="auto">
  <name>Task 2: Add Maple-style factor form to formatProdmake</name>
  <files>src/repl.h</files>
  <action>
Extend formatProdmake to support Maple factor style per qseriesdoc Output (2):
- Add optional parameter: `formatProdmake(const std::map&lt;int,Frac&gt;& a, bool mapleStyle = true)`
- When mapleStyle is true: for n=1 emit `(1-q)`, for n>1 emit `(-q^n+1)` instead of `(1-q^n)`
- Use existing expToUnicode for exponents
- Wire display(): when printing std::map&lt;int,Frac&gt; (prodmake result), call formatProdmake(arg, true) so prodmake output matches qseriesdoc

Keep denominator structure "1 / ((" ... "))" unchanged.
  </action>
  <verify>Build. Run: echo "prodmake(sum(q^(n^2)/aqprod(q,q,n,50),n,0,8), 40)" | ./qseries — factors must show (1-q)(-q⁴+1)(-q⁶+1)... not (1-q)(1-q⁴)(1-q⁶)...</verify>
  <done>prodmake output uses Maple factor style (1-q) and (-q^n+1) for n>1.</done>
</task>

<task type="auto">
  <name>Task 3: Update Rogers-Ramanujan demo block</name>
  <files>demo/garvan-demo.sh</files>
  <action>
Update the Rogers-Ramanujan block to emit both Output (1) and (2) per qseriesdoc §3.1:

Change:
  run "rr := sum(q^(n^2)/aqprod(q,q,n,50), n, 0, 8)" "prodmake(rr, 40)"

To:
  run "rr := sum(q^(n^2)/aqprod(q,q,n,50), n, 0, 8)" "series(rr, 50)" "prodmake(rr, 40)"

This adds explicit series display (Output (1) style, 50 terms) between the assign and prodmake (Output (2)).
  </action>
  <verify>cd dist && bash demo/garvan-demo.sh — Rogers-Ramanujan section must show: (1) 50-term series ending O(q⁵⁰), (2) product 1/((1-q)(-q⁴+1)(-q⁶+1)...)).</verify>
  <done>Demo emits both series expansion (50 terms) and product form in qseriesdoc style.</done>
</task>

</tasks>

<verification>
- make demo (or cd dist && bash demo/garvan-demo.sh) runs without error
- Rogers-Ramanujan block output matches qseriesdoc §3.1 Output (1) and (2) format (50 terms, Unicode O, Maple factors)
- g++ build succeeds; no regressions in other demo sections
</verification>

<success_criteria>
1. Sum Σ q^(n²)/(q;q)_n is computed and displayed with 50 terms in demo
2. prodmake on that sum yields infinite product form with Maple-style factors
3. Output format matches qseriesdoc §3.1 Output (1) and (2) style
</success_criteria>

<output>
After completion, create `.planning/phases/12-rogers-ramanujan-demo/12-01-SUMMARY.md`
</output>
