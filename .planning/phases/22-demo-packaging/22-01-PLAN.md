---
phase: 22-demo-packaging
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Makefile
  - demo/garvan-demo.sh
  - demo/README-dist.md
autonomous: true

must_haves:
  truths:
    - "User can obtain qseries-demo/ containing binary, garvan-demo.sh, README.md"
    - "cd qseries-demo && bash garvan-demo.sh runs the demo regardless of CWD"
    - "README explains contents, Bash requirement for Windows, and how to run"
  artifacts:
    - path: demo/README-dist.md
      provides: "Distribution README template with contents, requirements, run instructions"
    - path: Makefile
      provides: "package-demo target copying binary + script + README into qseries-demo/"
    - path: demo/garvan-demo.sh
      provides: "DIR-based binary resolution for flat and nested layouts"
  key_links:
    - from: Makefile
      to: qseries-demo/
      via: "package-demo target cp commands"
      pattern: "cp.*qseries-demo"
    - from: demo/garvan-demo.sh
      to: binary
      via: "DIR-based BIN resolution"
      pattern: "BASH_SOURCE|BIN=.*DIR"
---

<objective>
Produce a single distributable folder (qseries-demo/) containing the qseries binary, garvan-demo.sh, and README.md via `make package-demo`. The demo script must resolve the binary by script directory so it runs regardless of CWD. README documents Bash requirement (Git Bash/Cygwin/WSL on Windows) and run instructions.

Purpose: Satisfy QOL-08 â€” users can zip and share a self-contained demo folder.
Output: Makefile package-demo target, demo/garvan-demo.sh with DIR-based resolution, demo/README-dist.md template.
</objective>

<execution_context>
@C:/Users/ggarv/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ggarv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-demo-packaging/22-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: DIR-based binary resolution in garvan-demo.sh</name>
  <files>demo/garvan-demo.sh</files>
  <action>
Replace the CWD-based BIN resolution (lines 6-12) with DIR-based resolution so the script works in both layouts:
- Flat (qseries-demo/): script and binary in same folder
- Nested (dist/demo/): script in demo/, binary in dist/

Add at top after set -e:
  DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
  BIN="$DIR/qseries.exe"
  [ -f "$BIN" ] || BIN="$DIR/qseries"
  [ -f "$BIN" ] || BIN="$DIR/../qseries.exe"
  [ -f "$BIN" ] || BIN="$DIR/../qseries"
  [ -f "$BIN" ] || { echo "error: qseries not found"; exit 1; }

Remove the old BIN="./qseries.exe" ... logic. Update the run-from comment to mention both dist/ and qseries-demo/.
  </action>
  <verify>make demo (runs from dist/) and make package-demo then cd qseries-demo && bash garvan-demo.sh (flat layout); both must succeed</verify>
  <done>garvan-demo.sh finds binary in flat layout (qseries-demo) and nested layout (dist/demo)</done>
</task>

<task type="auto">
  <name>Task 2: Create demo/README-dist.md</name>
  <files>demo/README-dist.md</files>
  <action>
Create demo/README-dist.md as the distribution README template. Use qseries-demo/README.md as reference. Include:
- Title: Q-Series Demo
- Contents: qseries.exe (or qseries), garvan-demo.sh, README.md
- Requirements: Bash (Git Bash, Cygwin, or WSL on Windows; built-in on Linux/macOS)
- How to run: cd qseries-demo then bash garvan-demo.sh
- Interactive REPL: ./qseries.exe or ./qseries
- Optional: rebuild instructions (cd qseries3, bash build.sh, cp dist/qseries.exe qseries-demo/)
  </action>
  <verify>File demo/README-dist.md exists; grep -E "Contents|Requirements|How to run|bash" demo/README-dist.md returns matches</verify>
  <done>Distribution README template exists with all required sections</done>
</task>

<task type="auto">
  <name>Task 3: Extend Makefile package-demo</name>
  <files>Makefile</files>
  <action>
Extend the package-demo target (lines 45-48) to copy all three artifacts into qseries-demo/:
1. Keep existing: mkdir -p qseries-demo and cp dist/qseries.exe (or qseries)
2. Add: cp demo/garvan-demo.sh qseries-demo/
3. Add: cp demo/README-dist.md qseries-demo/README.md
4. Update echo to: "qseries-demo/ ready. Zip and share. Run: cd qseries-demo && bash garvan-demo.sh"
  </action>
  <verify>make package-demo; ls qseries-demo shows qseries.exe (or qseries), garvan-demo.sh, README.md; cd qseries-demo && bash garvan-demo.sh runs successfully</verify>
  <done>package-demo produces complete distributable folder with binary, script, and README</done>
</task>

</tasks>

<verification>
1. make package-demo produces qseries-demo/ with exactly 3 files: binary, garvan-demo.sh, README.md
2. bash garvan-demo.sh runs from qseries-demo/ (regardless of CWD from which it was invoked)
3. README.md explains Bash requirement for Windows and run steps
4. make demo still works (nested dist/demo layout)
</verification>

<success_criteria>
- User can run make package-demo and obtain qseries-demo/ ready to zip and share
- Folder contains binary, garvan-demo.sh, README.md
- cd qseries-demo && bash garvan-demo.sh runs the demo
- README documents Bash requirement and run instructions
</success_criteria>

<output>
After completion, create .planning/phases/22-demo-packaging/22-01-SUMMARY.md
</output>
