---
phase: 02-frac
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified: [src/main.cpp]
autonomous: true

must_haves:
  truths:
    - "SPEC cases pass: 6/4→3/2, 0/5→0/1, long-chain no growth"
    - "add/sub/mul/div and sign cases pass"
    - "Frac tests must pass before Phase 3"
  artifacts:
    - path: src/main.cpp
      provides: BigInt + Frac test driver
      contains: "Frac"
  key_links:
    - from: "main.cpp"
      to: "frac.h"
      via: "#include"
      pattern: "#include.*frac"
---

<objective>
Extend src/main.cpp with Frac test suite. Per CONTEXT: broader suite (SPEC cases + add/sub/mul/div + sign). Must pass before Phase 3.
</objective>

Purpose: Validate Frac implementation. Locked decision: both standalone (this) and integration (Phase 3) tests; must pass before Phase 3.
Output: main.cpp runs BigInt and Frac tests; exits 0 when all pass.

<execution_context>
@C:/Users/ggarv/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ggarv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-frac/02-CONTEXT.md
@.planning/phases/02-frac/02-RESEARCH.md
@SPEC.md
@src/main.cpp
@src/frac.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Frac include and SPEC cases</name>
  <files>src/main.cpp</files>
  <action>
Add #include "frac.h" after bigint.h. Keep existing BigInt tests. Add new section "=== Frac Phase 2 test driver ===" (or append after BigInt section).

Add Frac test groups using the same CHECK macro:

1. **SPEC reduction**: 6/4→3/2, 0/5→0/1
   - CHECK(Frac(6,4).str() == "3/2");
   - CHECK(Frac(0,5).str() == "0");
   - CHECK(Frac(0,5).num == BigInt(0) && Frac(0,5).den == BigInt(1));

2. **Zero denominator throws** (per locked decision):
   - try { Frac(1,0); } catch (std::invalid_argument&) { threw = true; }
   - try { Frac(1,2) / Frac(0); } catch (std::invalid_argument&) { threw = true; }
</action>
  <verify>make; ./qseries.exe (or equivalent); Frac section runs; 6/4→3/2 and 0/5→0/1 pass; zero-denom throws verified</verify>
  <done>SPEC reduction and zero-denom throw tests pass</done>
</task>

<task type="auto">
  <name>Task 2: add/sub/mul/div and sign cases</name>
  <files>src/main.cpp</files>
  <action>
Add Frac arithmetic and sign tests:

1. **add/sub/mul/div**:
   - 1/2 + 1/3 == 5/6
   - 1/2 - 1/3 == 1/6
   - 1/2 * 2/3 == 1/3
   - 1/2 / 2/3 == 3/4
   - (-1/2) + (1/2) == 0
   - (-1/2) * 2 == -1

2. **Sign handling**:
   - Frac(-3,4).str() == "-3/4"
   - Frac(3,-4).str() == "-3/4" (reduce flips to den>0)
   - Comparisons: Frac(-1,2) < Frac(1,2), Frac(1,3) < Frac(1,2)

3. **str()**:
   - Frac(7).str() == "7" (integer form)
   - Frac(0).str() == "0"
</action>
  <verify>All add/sub/mul/div and sign CHECKs pass</verify>
  <done>Arithmetic and sign tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Long-chain growth test</name>
  <files>src/main.cpp</files>
  <action>
Add long-chain test to verify no exponential BigInt growth. Per phase goal: "Long chains produce no exponential BigInt growth."

Implement: Start with f = Frac(1,1). In a loop (e.g. 50 iterations): f = f + Frac(1, 2) or f = f * Frac(1, 2) + Frac(1, 2) — any chain that would blow up if reduce() were skipped. After loop, verify f.str() has reasonable length (e.g. string length under a threshold like 200 for 50 iterations). Alternative: f = (f + Frac(1,2)) * Frac(1,2); repeated; check denominator magnitude stays bounded.

Simple formulation: f = Frac(1,1); for (int i=0;i<50;i++) f = f + Frac(1,2); 
Then f = 1 + 50*(1/2) = 26. Denominator should be 1. CHECK(f.den == BigInt(1) && f.num == BigInt(26)).

Or multiplication chain: f = Frac(1,1); for (i=0;i<20;i++) f = f * Frac(3,2); 
Unreduced would give den=2^20. Reduced: f = (3/2)^20, still large but single gcd. Verify it completes quickly and f is in reduced form.
</action>
  <verify>Long-chain test completes in reasonable time; result is reduced; no exponential growth observed</verify>
  <done>Long-chain test passes; Phase 2 success criteria satisfied</done>
</task>

</tasks>

<verification>
- make (or g++ -std=c++20 -O2 -static -o qseries src/main.cpp) succeeds
- ./qseries.exe exits 0
- All BigInt tests still pass
- All Frac tests pass (SPEC + arithmetic + sign + long-chain)
</verification>

<success_criteria>
- Phase 2 success criteria met: 6/4→3/2, 0/5→0/1; reduce everywhere; no exponential growth
- Test suite covers SPEC cases, add/sub/mul/div, sign, long-chain
- Ready for Phase 3 (Series)
</success_criteria>

<output>
After completion, create `.planning/phases/02-frac/02-02-SUMMARY.md`
</output>
