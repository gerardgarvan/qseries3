---
phase: 18-timing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/repl.h
autonomous: true

must_haves:
  truths:
    - "Elapsed time shown after each command output when stdin is TTY"
    - "Time on next line, format 0.042s (always seconds)"
    - "No timing in script mode (stdin not TTY)"
  artifacts:
    - path: src/repl.h
      provides: runRepl with timing
---

<objective>
Add elapsed-time display to runRepl(): after each command that produces output, when stdin is a TTY, print elapsed seconds (e.g. 0.042s) on the next line. Time includes parse + eval + display. No timing when piping/redirecting.

Purpose: QOL-04
</objective>

<execution_context>
@C:/Users/ggarv/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/18-timing/18-CONTEXT.md
@.planning/phases/18-timing/18-RESEARCH.md
@src/repl.h
</context>

<tasks>

<task type="auto">
  <name>Add timing to runRepl loop</name>
  <files>src/repl.h</files>
  <action>
1. Add #include &lt;chrono&gt; and #include &lt;iomanip&gt; to repl.h (if not already present).

2. In runRepl() main loop, around the try block that does parse/evalStmt/display:
   - Before parse(trimmed), record: auto t0 = std::chrono::steady_clock::now();
   - After display(res, env, env.T), record: auto t1 = std::chrono::steady_clock::now();
   - If stdin_is_tty(): compute double secs = std::chrono::duration&lt;double&gt;(t1 - t0).count(); print std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; secs &lt;&lt; "s" &lt;&lt; std::endl;

3. Place timing print only when we reach display (i.e. not on continue for monostate). The timing wraps parse + evalStmt + display for that iteration.

4. Do NOT print timing when stdin is not a TTY (script mode).
  </action>
  <verify>
- Interactive: run qseries, type "q" — output then "0.001s" (or similar) on next line
- Script: echo "q" | qseries — no timing line
  </verify>
  <done>Timing shown after output, next line, seconds format, interactive only.</done>
</task>

</tasks>

<verification>
- Build succeeds
- Interactive: timing on next line after output
- Script mode: no timing
- Format: X.XXXs
</verification>

<success_criteria>
1. Elapsed time shown after each command (when interactive)
2. Time on next line, always seconds (e.g. 0.042s)
3. No timing in script mode
</success_criteria>

<output>
After completion, create `.planning/phases/18-timing/18-01-SUMMARY.md`
</output>
