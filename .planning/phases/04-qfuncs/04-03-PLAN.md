---
phase: 04-qfuncs
plan: 03
type: execute
wave: 3
depends_on: [04-02]
files_modified: [src/qfuncs.h]
autonomous: true

must_haves:
  truths:
    - "tripleprod(z,q,T) = Π (1-zq^{n-1})(1-z⁻¹q^n)(1-q^n)"
    - "quinprod(z,q,T) per SPEC five factors"
    - "winquist(a,b,q,T) double sum per SPEC formula"
  artifacts:
    - path: src/qfuncs.h
      provides: tripleprod, quinprod, winquist
      contains: "tripleprod"
  key_links:
    - from: "tripleprod"
      to: "Series::inverse"
      via: "z⁻¹"
      pattern: "inverse"
---

<objective>
Add tripleprod, quinprod, winquist to qfuncs.h. Per CONTEXT and SPEC.
</objective>

Purpose: Product identities for Winquist, Euler pentagonal, Macdonald. Phase 6+ use them.
Output: tripleprod(z,q,T), quinprod(z,q,T), winquist(a,b,q,T).

<execution_context>
@C:/Users/ggarv/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ggarv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/04-qfuncs/04-CONTEXT.md
@.planning/phases/04-qfuncs/04-RESEARCH.md
@SPEC.md
@src/qfuncs.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: tripleprod(z, q, T)</name>
  <files>src/qfuncs.h</files>
  <action>
Implement tripleprod(z, q, T) = Π_{n≥1} (1 - z·q^{n-1})(1 - z⁻¹·q^n)(1 - q^n).

- For n=1..T-1: multiply by (1 - z·q^{n-1}), (1 - z⁻¹·q^n), (1 - q^n); truncate after each
- z⁻¹ = z.inverse() — requires z invertible (nonzero constant or minExp handling)
- q^{n-1}, q^n via q.pow() or qpow; combine with z
</action>
  <verify>tripleprod(q, q^3, 10) or similar per Garvan example</verify>
  <done>tripleprod implemented</done>
</task>

<task type="auto">
  <name>Task 2: quinprod(z, q, T)</name>
  <files>src/qfuncs.h</files>
  <action>
Implement quinprod(z, q, T) = (-z;q)_∞·(-q/z)_∞·(z²q;q²)_∞·(q/z²;q²)_∞·(q;q)_∞.

Per SPEC:
- For n=1,2,... while n<T: multiply (1+z·q^{n-1}), (1+q^n/z), (1-q^n)
- For m with 2m-1<T: multiply (1-z²·q^{2m-1}), (1-q^{2m-1}/z²)

Interleave factors as in RESEARCH. z⁻¹ for 1/z terms.
</action>
  <verify>quinprod spot-check coefficients</verify>
  <done>quinprod implemented</done>
</task>

<task type="auto">
  <name>Task 3: winquist(a, b, q, T)</name>
  <files>src/qfuncs.h</files>
  <action>
Implement winquist(a, b, q, T) per SPEC:

Σ_{n≥0} Σ_m (-1)^{n+m} · [(a^{-3n}-a^{3n+3})(b^{-3m}-b^{3m+1}) + (a^{1-3m}-a^{3m+2})(b^{3n+2}-b^{-3n-1})] · q^{3n(n+1)/2 + m(3m+1)/2}

- Sum over n≥0 and all m (positive and negative) such that exponent < T
- a^{-k} = a.inverse().pow(k); a,b must be invertible
- Build each term as Series, accumulate
</action>
  <verify>winquist(1,1,q,T) or Garvan specialization matches</verify>
  <done>winquist implemented</done>
</task>

</tasks>

<verification>
- tripleprod, quinprod, winquist compile; Garvan examples
</verification>

<success_criteria>
- All three product identities implemented per SPEC
- Ready for 04-04 (test suite)
</success_criteria>

<output>
After completion, create `.planning/phases/04-qfuncs/04-03-SUMMARY.md`
</output>
